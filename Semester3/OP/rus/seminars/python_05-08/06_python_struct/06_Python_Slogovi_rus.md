# Структурированные бинарные файлы

## Тип struct в языке программирования C

- Структуры (записи) в языке программирования C представляют собой сложные пользовательские типы данных.
- Компоненты (поля) структуры именованы и могут иметь разные типы.
- Пример определения структуры:
  ```c
  struct student {
      char index[12];
      char name[16];
      char surname[16];
      int studyYear;
  };
  ```

## Модуль `struct`

Модуль `struct` обеспечивает конвертацию между объектами Python и структурами C, представленными в виде объектов `bytes`. Для описания способа упаковки/распаковки значений переменных (полей структуры) в байты используются строки формата. Используя модуль `struct`, можно создавать бинарные файлы в Python и читать их в C, и наоборот.

## Основные функции модуля `struct`:

- **`struct.pack(format, v1, v2, ...)`**: используется для упаковки значений переменных v1, v2, ... в байты с использованием заданного строки формата.
- **`struct.unpack(format, buffer)`**: возвращает кортеж `_tuple_`, полученный распаковкой буфера `buffer`.
- **`struct.calcsize(format)`**: определяет размер структуры (в байтах), описанной строкой формата.

## Строка формата

Строка формата указывает, как значения переменных будут упакованы/распакованы в/из массива байтов. Пример строки формата:

- `pack('hhl', 1, 2, 3)`
- `pack('ci', b'*', 0x12131415)`
- `pack('i7s', 1234, b"test")`
- `calcsize('ci')`

Когда строка формата указывает на сохранение строкового значения, необходимо явно указать максимальное количество символов в строке. Из-за того, как строки хранятся в C, это значение всегда должно быть **увеличено на 1**. Пространство для символа _`\0`_ (нулевой символ).

| Формат C | Тип Python | Тип | Стандартный размер |
| -------- | ---------- | --- | ------------------ |
| x        | -          | -   | пустой байт без значения |
| c        | char       | байты длиной 1 | 1 |
| b        | signed char | целое число 1 | 1 |
| ?        | _Bool       | логическое значение | 1 |
| h        | short       | целое число 2 | 2 |
| i        | int         | целое число 4 | 4 |
| l        | long        | целое число 4 | 4 |
| q        | long long   | целое число 8 | 8 |
| f        | float       | число с плавающей точкой 4 | 4 |
| d        | double      | число с плавающей точкой 8 | 8 |
| s        | char[]      | байты | - |
| p        | char[]      | байты | - |

# Задачи и примеры

## Пример 1

Прочитать заданный CSV-файл и сохранить его содержимое в бинарный файл. Записи должны соответствовать строкам входного файла CSV. Колонки из CSV-файла: Имя пользователя, Идентификатор, Имя, Фамилия.

## Пример 2

Прочитать бинарный файл, созданный в предыдущем примере, и вывести содержимое 2-ой и 5-ой записей.

## Задача 1

Массив 2D точек задан во входном текстовом файле:
``````plaintext
1.23 -6.
12.45 -0.
34.55 82.
``````
Загрузить данный массив и сохранить его содержимое в выходной бинарный файл, при этом в начале файла должен быть заголовок с двумя целочисленными значениями:

- количество точек,
- размерность точек (в данном случае 2).

## Задача 2

- Загрузить бинарный файл, созданный в предыдущей задаче, используя данные из заголовка, то есть без предварительного знания о количестве точек и их размерности. 
- Вычислить центр масс (центроид) массива точек. 
- Изменить Задачу 1 так, чтобы она работала с массивом 3D точек, и затем протестировать решение Задачи 2 с новым бинарным файлом.

## Задача 3

Прочитать содержимое бинарного файла _username.bin_ следующим образом:

- Считать, что файл разделен на блоки с фактором блокировки 3.
- Прочитать второй блок (который состоит из последних 3 записей).
- Извлечь данные о записях из прочитанного блока, декодировать их и вывести на экран. 
- Ожидаемый вывод программы:
  ``` python
  ['jenkins46', 9346, 'Mary', 'Jenkins']  
  ['smith79', 5079, 'Jamie', 'Smith']  
  ['vlad58', 5858, 'Vlad', 'Nevski']  
  ```
